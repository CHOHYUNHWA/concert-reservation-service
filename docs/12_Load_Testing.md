# 서비스 장애 대응을 위한 부하 테스트

## 부하 테스트 목표

- 서비스 운영 중 예상치 못한 트래픽 증가 상황에 대비하여, **K6, Grafana, Prometheus를 활용한 부하 테스트 및 성능 모니터링**을 수행합니다.
- 이를 통해 서비스가 감당할 수 있는 최대 부하 수준을 측정하고, 대량 트래픽 발생 시 성능 저하 없이 원활하게 대응할 수 있도록 시스템을 최적화하여 안정적인 서비스 운영을 보장하는 것이 목표입니다.

<br/>

## 테스트 대상 API
> 부하테스트를 위해서 트래픽이 많이 발생할 것으로 예상되는 API를 조사하고, 해당 API를 대상으로 선정한다.

1. `POST`-`/api/queues/token` : 대기열 토큰 생성
   - 해당 API는 콘서트 예약 가능 시간이 오픈될 때 가장 많은 요청이 집중될 것으로 예상되며, 단시간 내 폭발적인 트래픽 증가가 발생하는 대표적인 API
   - 대량의 동시 요청이 발생할 가능성이 높고, 각 요청이 서버에서 적절히 처리되지 않을 경우 대기열 시스템 장애 및 성능 저하로 이어질 수 있음
   - 트래픽이 급격하게 몰리는 상황에서 API의 처리 속도가 유지되며, 부하를 견디는지 검증
2. `GET`-`/api/queues/status` : 대기열 토큰 상태 조회
   - 해당 API는 사용자가 대기열에 진입한 후 지속적으로 상태를 확인하기 위해 주기적으로 호출되며, 지속적인 트래픽 부하가 예상됨
   - 토큰이 유효한 동안 일정 간격으로 지속적인 요청이 발생하며, 사용자 수가 증가할수록 부하가 점진적으로 증가할 가능성이 큼
   - 특히, 새로운 사용자가 대기열에 추가되면서 요청 수가 더욱 늘어나기 때문에 트래픽이 기하급수적으로 증가할 수 있음
   - 서버가 이러한 지속적인 요청을 효과적으로 처리하고 응답할 수 있는지, 캐싱 및 부하 분산 전략이 제대로 적용되는지 검증 필요
3. `GET`-`/api/concerts/{concertId}/schedules` : 예약 가능 일정 조회
    - 콘서트 예약을 원하는 사용자는 먼저 해당 콘서트의 예약 가능 일정을 조회해야 하며, 이 과정에서 짧은 시간 동안 다수의 사용자가 동시에 요청을 보낼 가능성이 높음
    - 예약 가능 일정을 조회할 때, 단순한 조회가 아니라 데이터베이스에서 조건 범위 내의 일정 데이터를 가져와야 하기 때문에, DB 부하가 증가할 수 있음
    - 사용자가 많아질수록 동시 조회 요청이 많아지고, DB 응답 시간이 지연될 경우 서버 자원이 묶이면서 전체 시스템 성능이 저하될 가능성 있음
    - DB 인덱싱 및 캐싱 전략을 적절히 적용하지 않으면, 응답 지연으로 인해 API 성능이 크게 저하될 위험이 있음
4. `GET`-`/api/concerts/{concertId}/schedules/{concertScheduleId}/seats` : 예약가능 좌석 조회
    - 좌석 조회 API는 예약 과정에서 필수적으로 호출되는 API로, 실시간 데이터 조회가 필수적임
    - 예약이 진행됨에 따라 좌석 상태(예약 가능/불가능)가 실시간으로 변동되며, 다수의 사용자가 동시에 좌석 정보를 조회하거나 특정 좌석을 선택할 수 있기 때문에 요청 충돌(Concurrency Issue)이 발생할 가능성이 높음
    - 트래픽이 많아질 경우, 최신 좌석 정보를 빠르게 조회해야 하며, 실시간 응답 성능이 저하될 경우 사용자 경험에 악영향을 줄 수 있음
    - 좌석 정보가 동적으로 변하는 만큼 데이터 정합성을 유지하는 것이 중요하며, 많은 트래픽 요청 상황에서 올바른 Redis 캐싱이나 DB 락이 적용되었는지 함께 검증

<br/>

## 테스트 환경

### 하드웨어 및 시스템 환경

- 운영체제: mac
- 프로세서: Apple Silicon M3 Pro
- 메모리(RAM): 32GB
- Docker: Docker Desktop for Mac
    - Docker Engine: 27.3.1

### 테스트 및 모니터링 툴
- Prometheus: 3.2.0 
- Grafana: 11.5.2
- K6: 0.57.0


<br/>

## 테스트 시나리오 및 결과 분석

<br/>

## 결론 및 정리